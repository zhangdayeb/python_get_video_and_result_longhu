================================================================================
                         龙虎监控系统文档
================================================================================

文档索引
--------------------------------------------------------------------------------

    文档                        说明
    ----                        ----
    0 配置与转换规则.txt        配置文件、桌号映射、编码转换、gameType对应
    1 数据格式说明.txt          牌面数据格式、result_pai、花色映射
    2 数据同步流程.txt          路单同步、开牌数据发送、数据库操作
    3 GUI与截图.txt             界面展示、截图预览、回调流程
    4 监控说明.txt              监控系统详细说明(DOM/HTTP/Storage)
    流程.txt                    系统架构概述、数据来源汇总

================================================================================

快速开始
--------------------------------------------------------------------------------

    1. 安装依赖
       pip install -r requirements.txt
       playwright install chromium

    2. 运行安装脚本 (首次)
       python install.py

    3. 启动程序
       方式1: 双击 bat/start_desk1.bat (推荐)
       方式2: python main.py --desk 1 --port 9223

================================================================================

项目结构
--------------------------------------------------------------------------------

    python_get_video_and_result_longhu/
    ├── main.py                 # 主程序入口
    ├── config.json             # 配置文件
    ├── install.py              # 安装脚本
    ├── requirements.txt        # Python依赖
    │
    ├── bat/                    # 启动脚本目录
    │   ├── start_desk1.bat     # 桌台1启动脚本 (端口9223)
    │   ├── start_desk2.bat     # 桌台2启动脚本 (端口9224)
    │   └── ...                 # 桌台3-28
    │
    ├── src/                    # 源代码目录
    │   ├── core/               # 核心模块
    │   │   ├── config.py       # 配置管理
    │   │   ├── database.py     # 数据库操作
    │   │   ├── logger.py       # 日志管理
    │   │   └── game_processor.py # 游戏数据处理
    │   │
    │   ├── api/                # API模块
    │   │   └── backend.py      # 后端API调用
    │   │
    │   ├── monitor/            # 监控模块
    │   │   ├── browser_monitor.py  # DOM监控主模块
    │   │   ├── http_monitor.py     # HTTP请求监控
    │   │   └── storage_monitor.py  # Storage监控
    │   │
    │   ├── capture/            # 截图模块
    │   │   └── capture.py      # 截图功能
    │   │
    │   ├── ai/                 # AI识别模块
    │   │   └── recognizer.py   # ResNet101牌面识别
    │   │
    │   ├── ui/                 # 界面模块
    │   │   └── windows_ui.py   # Windows GUI
    │   │
    │   ├── auto_login_roadmap/ # 路单浏览器自动登录
    │   │   └── login.py
    │   │
    │   ├── auto_login_flv/     # FLV浏览器自动登录
    │   │   └── login.py
    │   │
    │   └── flv_push/           # FLV推流模块
    │       └── stream_pusher.py
    │
    ├── models/                 # AI模型文件
    │   └── best_resnet101_model.pth
    │
    ├── temp/                   # 运行时临时文件
    │   └── desk_{N}/           # 各桌台独立目录
    │       ├── logs/           # 日志文件
    │       └── screenshots/    # 截图文件
    │
    └── docs/                   # 文档目录

================================================================================

核心转换规则
--------------------------------------------------------------------------------

1. 龙虎模式 (马总模式)

    项目          说明
    ----          ----
    胜负编码      1=龙赢, 2=虎赢, 3=和
    gameType      2 (龙虎)
    ext编码       固定为0 (龙虎无对子)

    **注意**: 所有地方统一使用 gameType = 2

--------------------------------------------------------------------------------

2. 桌号映射 (desk_id → table_id)

    利博桌号    马总table_id    名称
    --------    ------------    ----
    1           1               F1
    2           2               F2
    3           3               F3
    ...

--------------------------------------------------------------------------------

3. 牌面数据格式 (龙虎版本)

    {"1": "0|0", "2": "0|0"}

    - 1 = 龙牌
    - 2 = 虎牌
    - "0|0" = 无牌(默认值)
    - "13|h" = K 黑桃

================================================================================

龙虎规则
--------------------------------------------------------------------------------

1. 牌面数量
   - 龙虎只有2张牌: 龙牌 + 虎牌
   - 无补牌规则

2. 比大小规则
   K(13) > Q(12) > J(11) > 10 > 9 > 8 > 7 > 6 > 5 > 4 > 3 > 2 > A(1)
   - 龙牌 > 虎牌: 龙赢 (result=1)
   - 虎牌 > 龙牌: 虎赢 (result=2)
   - 相等: 和局 (result=3)

================================================================================

启动脚本说明
--------------------------------------------------------------------------------

    启动脚本位于 bat/ 目录下，每个桌台对应一个脚本:

    脚本名称            桌台    调试端口    说明
    --------            ----    --------    ----
    start_desk1.bat     1       9223        桌台1
    start_desk2.bat     2       9224        桌台2
    ...                 ...     ...         ...
    start_desk28.bat    28      9250        桌台28

    多开方式:
    - 直接双击多个 bat 文件即可同时运行多个桌台
    - 每个桌台使用独立的调试端口和临时目录

================================================================================

版本
--------------------------------------------------------------------------------

v5.1 (2025-12-22)
- 龙虎版本发布
- 支持龙虎游戏 (gameType=2)
- 2张牌识别 (龙牌+虎牌)
- 直接比大小规则

v5.0 (2025-12-18)
- 新增 AI 牌面识别 (ResNet101)
- 新增 FLV 推流功能
- 新增多桌台并行运行支持
- 优化监控循环稳定性
- 非阻塞 API 调用
- 完善日志系统

v2.1.0 (2025-12-12)
- 修复 gameType 转换问题
- 修复 result_pai 默认值问题
- 完善文档

================================================================================
